<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <meta name="description" content="android下针对UI的单元测试工具">

  <title>
    
      android下针对UI的单元测试工具 &middot; Example Code
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/poole.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <link rel="stylesheet" href="/assets/css/hyde.css">


  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">

  <div class="sidebar-about">
      <h1>
        <a href="">
          Example Code
        </a>
        <hr>
      </h1>
      <p class="lead">自由懒散的程序员一枚，因为懒，所以喜欢极简主义，憎恨一切形式化的东西。不喜欢写BLOG，直到遇见了Jekyll，让我感到写文章有写代码的感觉</p>

  </div>

  <div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">首页</a>

      

      
      
        
          
            <a class="sidebar-nav-item" href="/about.html">关于</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive.html">归档</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/categories.html">分类</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/tags.html">Tags</a>
          
        
      
    </nav>
    
  </div>

    <div>

     <a href="mailto:chengkai.me@gmail.com"><img class="contact-icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNODUuOSwyMC4ySDE0LjFjLTEuNCwwLTIuNiwxLjEtMi42LDIuNnY1LjFjMCwwLjIsMC4zLDAuNSwwLjUsMC42bDM3LjgsMjEuNmMwLjEsMC4xLDAuMiwwLjEsMC4zLDAuMQ0KCQljMC4xLDAsMC4yLDAsMC4zLTAuMUw4NywyOC41YzAuMi0wLjEsMC44LTAuNCwxLTAuNmMwLjItMC4yLDAuNS0wLjMsMC41LTAuNnYtNC42Qzg4LjUsMjEuMyw4Ny40LDIwLjIsODUuOSwyMC4yeiIvPg0KCTxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik04OC4yLDM1LjZjLTAuMi0wLjEtMC40LTAuMS0wLjYsMEw2Ni44LDQ3LjljLTAuMiwwLjEtMC4zLDAuMy0wLjMsMC41YzAsMC4yLDAsMC40LDAuMiwwLjVsMjAuNywyMi40DQoJCWMwLjEsMC4xLDAuMywwLjIsMC41LDAuMmMwLjEsMCwwLjIsMCwwLjIsMGMwLjItMC4xLDAuNC0wLjMsMC40LTAuNlYzNi4yQzg4LjUsMzYsODguNCwzNS44LDg4LjIsMzUuNnoiLz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNjAuOCw1MS45Yy0wLjItMC4yLTAuNS0wLjMtMC44LTAuMWwtOC4zLDQuOWMtMSwwLjYtMi4yLDAuNi0zLjIsMGwtNy4zLTQuMmMtMC4yLTAuMS0wLjUtMC4xLTAuOCwwLjENCgkJTDEyLjcsNzguNGMtMC4xLDAuMS0wLjIsMC4zLTAuMiwwLjVjMCwwLjIsMC4xLDAuNCwwLjMsMC41YzAuNCwwLjMsMC44LDAuNCwxLjMsMC40aDcxLjJjMC4zLDAsMC41LTAuMiwwLjYtMC40DQoJCWMwLjEtMC4yLDAuMS0wLjUtMC4xLTAuN0w2MC44LDUxLjl6Ii8+DQoJPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTM0LjMsNDkuNmMwLjItMC4xLDAuMi0wLjMsMC4yLTAuNWMwLTAuMi0wLjEtMC40LTAuMy0wLjVMMTIuNSwzNi4xYy0wLjItMC4xLTAuNC0wLjEtMC42LDANCgkJYy0wLjIsMC4xLTAuMywwLjMtMC4zLDAuNnYzMi42YzAsMC4zLDAuMSwwLjUsMC40LDAuNmMwLjEsMCwwLjIsMC4xLDAuMywwLjFjMC4yLDAsMC4zLTAuMSwwLjQtMC4yTDM0LjMsNDkuNnoiLz4NCjwvZz4NCjwvc3ZnPg0K" alt="Email" width="32" height="32" /></a>

     <a href="https://github.com/examplecode"><img class="contact-icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxOC4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTAwIDEwMCIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNNTAsMTJjLTIxLjUsMC0zOSwxNy41LTM5LDM5YzAsMTcuMiwxMS4yLDMxLjgsMjYuNywzN2MyLDAuNCwyLjctMC44LDIuNy0xLjljMC0wLjksMC0zLjQtMC4xLTYuNg0KCQljLTEwLjgsMi40LTEzLjEtNS4yLTEzLjEtNS4yYy0xLjgtNC41LTQuMy01LjctNC4zLTUuN2MtMy41LTIuNCwwLjMtMi40LDAuMy0yLjRjMy45LDAuMyw2LDQsNiw0YzMuNSw2LDkuMSw0LjIsMTEuNCwzLjINCgkJYzAuNC0yLjUsMS40LTQuMiwyLjUtNS4yYy04LjctMS0xNy44LTQuMy0xNy44LTE5LjNjMC00LjMsMS41LTcuNyw0LTEwLjVjLTAuNC0xLTEuNy00LjksMC40LTEwLjNjMCwwLDMuMy0xLDEwLjcsNA0KCQljMy4xLTAuOSw2LjQtMS4zLDkuOC0xLjNjMy4zLDAsNi43LDAuNCw5LjgsMS4zYzcuNC01LDEwLjctNCwxMC43LTRjMi4xLDUuNCwwLjgsOS4zLDAuNCwxMC4zYzIuNSwyLjcsNCw2LjIsNCwxMC41DQoJCWMwLDE1LTkuMSwxOC4zLTE3LjgsMTkuMmMxLjQsMS4yLDIuNiwzLjYsMi42LDcuMmMwLDUuMiwwLDkuNCwwLDEwLjdjMCwxLDAuNywyLjMsMi43LDEuOUM3Ny44LDgyLjgsODksNjguMiw4OSw1MQ0KCQlDODksMjkuNCw3MS41LDEyLDUwLDEyeiIvPg0KPC9nPg0KPC9zdmc+DQo=" alt="GitHub" width="32" height="32" /></a>

     <p>&copy; 2014. All rights reserved.</p>
    
   <!--  start of Google Analytics  -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45771839-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--  end of Google Analytics  -->
    </div>


</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">android下针对UI的单元测试工具</h1>
  <span class="post-date">23 Jun 2014</span>
  <p>这是一个非常简单的测试框架，帮助我们测试一些UI相关的用例，通常情况下我们使用Junit编写单元测试只是针对没有界面的非UI用例，而对于和界面相关的逻辑操作测试起来就不太方便，比如我只想
看看这个界面的运行效果，看看界面的布局是否达到预期 Junit就满足不了我们的要求。通常我们不得不创建一个很小的demo来演示我们的界面，那么UITestRunner就是帮助android开发者解决类似的问
题的，其实他就是你需要的那个很小的demo,只是他更加方便的以类似JUnitTest的方式把你的所有用例组织起来（你只要写一个以“test”开头的方法即可），并且把这些用例以列表的方式显示出来，测试其中一个用例，只需要点击列表项即可。</p>

<p><strong>源码地址:</strong><a href="https://github.com/examplecode/android-ui-test-runner">https://github.com/examplecode/android-ui-test-runner</a> </p>

<p><img style="float:left" src="/images/UITestRnnner-TestSuite.png" alt="测试套件列表" title="测试套件列表" width="300" /></p>

<p><img src="/images/UITestRunner-testCase.png" alt="测试用例列表" title="测试用例列表" width="300" /></p>

<hr />

<h2 id="uitestrunner">在你的项目中使用UITestRunner</h2>

<h3 id="step1-uitestrunnereclise">step1 导入UITestRunner到Eclise的工作空间</h3>

<p>UITestRunner需要和你要测试的项目在同一个workspace,首先我们需要把它导入到我们所在的workspace.</p>

<p>按照以下的步骤操作：</p>

<pre><code>File -&gt; Import -&gt; Existing Android Code Into WorkSpace
</code></pre>

<h3 id="step2--uitestrunner">step2 在你的项目中设置依赖 UITestRunner</h3>
<p>UITestRunner 是以lib类型的工程存在，我们必须设置我们的项目依赖UITestRunner.
按照以下步骤操作：</p>

<pre><code>选择你的项目 -&gt; 选择Properties(右键菜单) -&gt; 选择Android 
</code></pre>

<p>这时候你会看到下面这个界面,点击Add把UITestRunner添加进来。 </p>

<p><img src="/images/Depend-UITestRunner.png" alt="设置依赖UITestRunner" /> </p>

<h3 id="step3-uitestrunner">step3 添加UITestRunner的声明</h3>

<p>在你自己项目的AndroidManifest.xml中添加以下内容声明UITestActivity(测试用例的展示界面)</p>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;com.mmbox.uitestrunner.UITestActivity&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.mmbox.uitestrunner.Main&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span></code></pre></div>

<h3 id="step4-">step4 创建你自己的测试套件</h3>

<p>你可以根据不同的测试类型创建多个测试套件，创建测试套件很简单只需要创建一个Class从UITestSuite继承即可。建议我们创建一个package来存放所有的测试套件(不是必须只是为了清楚易于维护，包名可以自己定义), 如下图所示:</p>

<p><img src="/images/TestSuite-Package.png" alt="测试套件放置到一个统一的package下" /> </p>

<p>测试套件的实现代码如下所示：</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySampleTestSuite1</span> <span class="kd">extends</span> <span class="n">UITestSuite</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="nf">MySampleTestSuite1</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="c1">// TODO Auto-generated constructor stub</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<h3 id="step6-">step6 为已有的测试套件添加测试用例</h3>

<p>添加测试用例很简单，只需要在测试套件中增加一些以 “test” 开头的 public 方法即可，如以下代码：</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySampleTestSuite1</span> <span class="kd">extends</span> <span class="n">UITestSuite</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">MySampleTestSuite1</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="c1">// TODO Auto-generated constructor stub</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSayHello</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="s">&quot;Hello UITestRunner&quot;</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCase1InTestSuite1</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="s">&quot;testCase1InTestSuite1 is runngin&quot;</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCase2InTestSuite1</span><span class="o">()</span> 
    <span class="o">{</span>
        <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="s">&quot;testCase2InTestSuite1 is runngin&quot;</span><span class="o">,</span><span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
    <span class="o">}</span>
    
<span class="o">}</span></code></pre></div>

<h3 id="step5-">step5 启动测试用例</h3>

<p>完成以上步骤就可以通过eclise安装项目到你的设备或模拟器中了，启动测试用例很简单只需要输入下面的命令即可.</p>

<pre><code>adb shell am start -a com.mmbox.uitestrunner.Main
</code></pre>

<p>一切正常的话你将会看到下面的界面:</p>

<p><img src="/images/UITestRnnner-TestSuite.png" alt="测试套件列表" /></p>

<h2 id="view">在测试用例中测试一个View的布局显示</h2>

<p>我们除了在测试用例测试一些简单的逻辑外，还有一个经常需要的场景就是想看看一个布局文件的实际显示效果，这时候我们没有必要创建一个新的Activity来显示你的View，只需要在测试用例中调用showTestView方法即可. 框架提供了两个方法 showView,showLayout，分别用于显示一个View实例和展示一个布局文件。</p>

<h3 id="view-1">显示一个view实例</h3>

<h4 id="section">代码</h4>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testShowSimpleButton</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Button</span> <span class="n">btn</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Button</span><span class="o">(</span><span class="n">getContext</span><span class="o">());</span>
    <span class="n">btn</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">&quot;Click Me&quot;</span><span class="o">);</span>
    <span class="n">btn</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="k">new</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">(</span><span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">,</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="na">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">));</span>
    <span class="n">showView</span><span class="o">(</span><span class="n">btn</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>

<h4 id="section-1">展示效果</h4>

<p><img src="/images/test_view.png" alt="测试显示一个Button" title="测试显示一个Button" width="300" /></p>

<h3 id="section-2">显示一个布局文件</h3>

<h4 id="section-3">代码</h4>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testShowSimpleLayout</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">showLayout</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">show_layout_demo</span><span class="o">);</span>
    <span class="o">}</span></code></pre></div>

<h4 id="section-4">展示效果</h4>

<p><img src="/images/test_layout.png" alt="显示FrameLayout的布局测试" title="显示FrameLayout的布局测试" width="300" /></p>


</div>

<div class="related">
  <h2>相关文章</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/09/26/install-gollum-in-mac-109">
            在 mac 10.9 下安装 gollum 
            <small>26 Sep 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/09/23/install-ruby-rails-on-ubuntu">
            ubuntu下安装ruby rails环境
            <small>23 Sep 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/tools/2014/07/02/build-your-own-google-search-mirrors-service">
            自己搭建的google搜索镜像服务
            <small>02 Jul 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
